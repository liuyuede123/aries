(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-07000826"],{"05ef":function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"c",(function(){return l})),a.d(t,"b",(function(){return o}));var i=a("5530"),s=a("22ce");function n(e){return Object(s["b"])({url:"/images",method:"get",params:e})}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s["b"])(Object(i["a"])({url:"/images/attachment/upload",method:"post",data:e,headers:{token:localStorage.getItem("token"),"Content-Type":"multipart/form-data",Accept:"application/json"}},t))}function o(e){return Object(s["b"])({url:"/images?ids=".concat(e),method:"delete"})}},1720:function(e,t,a){"use strict";var i=a("d69a"),s=a.n(i);s.a},"1af8":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("d2-container",[a("template",{slot:"header"},[e._v("系统 / 附件")]),a("div",{staticClass:"operation-box"},[a("el-form",{staticClass:"demo-form-inline",attrs:{slot:"header",inline:!0},slot:"header"},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.isMultiVisible,expression:"!isMultiVisible"}]},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.isMultiVisible=!0}}},[a("i",{staticClass:"el-icon-edit-outline"}),e._v(" 批量操作 ")])],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.isMultiVisible,expression:"isMultiVisible"}]},[a("el-button",{attrs:{size:"small",type:"danger"},on:{click:e.handleMultiDelImages}},[a("i",{staticClass:"el-icon-delete"}),e._v(" 删除 ")])],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.isMultiVisible,expression:"isMultiVisible"}]},[a("el-button",{attrs:{size:"small"},on:{click:e.handleMultiCancel}},[a("i",{staticClass:"el-icon-close-tip"}),e._v(" 取消 ")])],1),a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleOpenUploadDialog}},[a("i",{staticClass:"el-icon-plus"}),e._v(" 上传 ")])],1),a("el-form-item",[a("el-select",{staticStyle:{width:"150px"},attrs:{size:"small",clearable:"",placeholder:"请选择图床类型"},model:{value:e.pagination.storage_name,callback:function(t){e.$set(e.pagination,"storage_name",t)},expression:"pagination.storage_name"}},e._l(e.picBedTypes,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),1)],1),a("el-form-item",[a("el-input",{attrs:{size:"small",placeholder:"请输入关键词"},model:{value:e.pagination.key,callback:function(t){e.$set(e.pagination,"key",t)},expression:"pagination.key"}})],1),a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.search}},[a("i",{staticClass:"el-icon-search"}),e._v(" 搜索")])],1),a("el-form-item",[a("el-button",{attrs:{size:"small"},on:{click:e.reset}},[a("i",{staticClass:"el-icon-refresh"}),e._v(" 重置")])],1)],1)],1),a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[0===e.data.length?a("el-col",{staticStyle:{margin:"0 auto 15px auto",height:"50px","background-color":"white"},attrs:{span:24}},[a("h4",{staticStyle:{width:"50%","line-height":"50px",margin:"auto",color:"#909399","text-align":"center","font-weight":"normal"}},[e._v("暂无数据")])]):e._e(),e._l(e.data,(function(t){return a("el-col",{key:t.ID,staticStyle:{margin:"0 3.32% 2% 0"},attrs:{span:4}},[a("div",{staticClass:"image-container",class:e.imgIsChecked(t.checked)},[a("span",{staticClass:"demonstration"},[e._v(e._s(t.file_name))]),a("el-checkbox",{directives:[{name:"show",rawName:"v-show",value:e.isMultiVisible,expression:"isMultiVisible"}],staticStyle:{position:"absolute"},on:{change:function(a){return e.handleCheckBoxChange(a,t)}},model:{value:t.checked,callback:function(a){e.$set(t,"checked",a)},expression:"item.checked"}}),a("el-image",{staticClass:"attach-image",attrs:{src:t.url,lazy:""},on:{click:function(a){return e.handleClickImg(t)}}})],1)])})),a("el-col",{attrs:{span:24}},[a("div",{staticClass:"page-box"},[a("el-pagination",{attrs:{background:"","page-sizes":[20,50,80,110],layout:"total, sizes, prev, pager, next, jumper","current-page":e.pagination.page,"page-size":e.pagination.size,"page-count":e.pagination.total_pages,total:e.pagination.total_num},on:{"size-change":e.handlePageSizeChange,"current-change":e.handleCurrentPageChange}})],1)])],2),a("el-dialog",{attrs:{title:"上传",visible:e.uploadDialogVisible,"with-header":!1,width:"50%"},on:{"update:visible":function(t){e.uploadDialogVisible=t},closed:e.handleCloseUploadDialog}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"",accept:".jpeg,.jpg,.png,.gif,.bmp",limit:e.limit,multiple:!0,"http-request":e.uploadImg,"before-upload":e.handleBeforeUpload,"on-exceed":e.handleOnExceed,"file-list":e.fileList,"list-type":"picture"}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传 jpeg/jpg/png/gif/bmp 文件，且不超过 5 MB，一次最多上传 10 个。")])],1)],1),a("el-dialog",{attrs:{title:"图片预览",visible:e.previewDialogVisible,"with-header":!1,width:"50%"},on:{"update:visible":function(t){e.previewDialogVisible=t}}},[a("el-image",{staticStyle:{width:"100%"},attrs:{src:e.previewData.url,fit:"cover"},on:{click:function(t){return e.openImgUrl(e.previewData.url)}}}),a("el-row",{staticStyle:{"border-bottom":"1px solid #eaeefb"}},[a("el-col",{attrs:{span:5}},[a("h4",{staticClass:"pre-tip"},[e._v("图床类型：")])]),a("el-col",{attrs:{span:19}},["sm.ms"===e.previewData.storage_type?a("h4",{staticClass:"pre-tip"},[e._v("sm.ms")]):e._e(),"imgbb"===e.previewData.storage_type?a("h4",{staticClass:"pre-tip"},[e._v("imgbb")]):e._e(),"cos"===e.previewData.storage_type?a("h4",{staticClass:"pre-tip"},[e._v("腾讯云 COS")]):e._e()])],1),a("el-row",{staticStyle:{"border-bottom":"1px solid #eaeefb"}},[a("el-col",{attrs:{span:5}},[a("h4",{staticClass:"pre-tip"},[e._v("图片名称：")])]),a("el-col",{attrs:{span:19}},[a("h4",{staticClass:"pre-tip"},[e._v(e._s(e.previewData.file_name))])])],1),a("el-row",{staticStyle:{"border-bottom":"1px solid #eaeefb"}},[a("el-col",{attrs:{span:5}},[a("h4",{staticClass:"pre-tip"},[e._v("图片大小：")])]),a("el-col",{attrs:{span:19}},[a("h4",{staticClass:"pre-tip"},[e._v(e._s(e.previewData.size)+" KB")])])],1),a("el-row",{staticStyle:{"border-bottom":"1px solid #eaeefb"}},[a("el-col",{attrs:{span:5}},[a("h4",{staticClass:"pre-tip"},[e._v("图片地址：")])]),a("el-col",{attrs:{span:19}},[a("h4",{staticClass:"pre-tip"},[e._v(" "+e._s(e.previewData.url)+" "),a("el-tooltip",{attrs:{content:"复制",placement:"top",effect:"light"}},[a("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.previewData.url,expression:"previewData.url",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.onCopySuccess,expression:"onCopySuccess",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:e.onCopyError,expression:"onCopyError",arg:"error"}],staticClass:"el-icon-document-copy",attrs:{size:"mini"}})],1)],1)])],1),a("el-row",{staticStyle:{"border-bottom":"1px solid #eaeefb"}},[a("el-col",{attrs:{span:5}},[a("h4",{staticClass:"pre-tip"},[e._v("Markdown 链接：")])]),a("el-col",{attrs:{span:19}},[a("h4",{staticClass:"pre-tip"},[e._v(" ![image]("+e._s(e.previewData.url)+") "),a("el-tooltip",{attrs:{content:"复制",placement:"top",effect:"light"}},[a("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:"![image]("+e.previewData.url+")",expression:"`![image](${previewData.url})`",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.onCopySuccess,expression:"onCopySuccess",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:e.onCopyError,expression:"onCopyError",arg:"error"}],staticClass:"el-icon-document-copy",attrs:{size:"mini"}})],1)],1)])],1)],1)],2)},s=[],n=(a("c975"),a("a15b"),a("baa5"),a("d81d"),a("a434"),a("b0c0"),a("05ef")),l={name:"attachment",created:function(){this.fetchPageData()},data:function(){return{picBedTypes:[{value:"sm.ms",name:"sm.ms"},{value:"imgbb",name:"imgbb"},{value:"cos",name:"腾讯云"}],pagination:{page:1,size:20,key:"",storage_name:null,total_num:0,total_pages:0},data:[],fileList:[],selectImages:[],previewData:{url:"",file_name:"",size:0,storage_type:"",createAt:null},imageTypes:["jpeg","jpg","png","gif","bmp"],limit:10,progressPercent:0,uploadDialogVisible:!1,previewDialogVisible:!1,isMultiVisible:!1,loading:!1}},methods:{fetchPageData:function(){var e=this;this.loading=!0,setTimeout((function(){Object(n["a"])({page:e.pagination.page,size:e.pagination.size,key:e.pagination.key,storage_name:e.pagination.storage_name}).then((function(t){t.data.data.map((function(t){e.$set(t,"checked",!1)})),e.data=t.data.data,e.pagination.total_num=t.data.total_num,e.pagination.total_pages=t.data.total_pages})).catch((function(){})),e.loading=!1}),300)},search:function(){this.pagination.page=1,this.fetchPageData()},reset:function(){this.pagination.page=1,this.pagination.key="",this.pagination.storage_name=null,this.fetchPageData()},handlePageSizeChange:function(e){this.pagination.size=e,this.fetchPageData()},handleCurrentPageChange:function(e){this.pagination.page=e,this.fetchPageData()},handleOpenUploadDialog:function(){this.uploadDialogVisible=!0},handleCloseUploadDialog:function(){this.fetchPageData(),this.fileList=[]},handleRemove:function(e,t){console.log(e,t)},handleBeforeUpload:function(e){var t=this.getFileType(e.name),a=e.size/1024/1024;return-1===this.imageTypes.indexOf(t)?(this.$message.error("仅支持上传 jpeg, jpg, png, gif 和 bmp 格式的图片"),!1):a>5?(this.$message.error("上传文件大小不能超过 5 MB"),!1):void 0},handleOnExceed:function(e,t){if(t.length>this.limit)return this.$message.error("最多允许上传 ".concat(this.limit," 个文件")),!1},uploadImg:function(e){var t=new FormData;t.append("file[]",e.file);var a={onUploadProgress:function(t){var a=t.loaded/t.total*100|0;e.onProgress({percent:a})}};Object(n["c"])(t,a).then((function(){e.onSuccess()})).catch((function(){}))},handleClickImg:function(e){if(this.isMultiVisible){if(e.checked){var t=this.selectImages.indexOf(e.ID);t>=0&&this.selectImages.splice(t,1)}else this.selectImages.push(e.ID);e.checked=!e.checked}else this.previewData=e,this.previewDialogVisible=!0},getFileType:function(e){return e.substring(e.lastIndexOf(".")+1)},openImgUrl:function(e){window.open(e)},doCopy:function(e){this.$copyText(e).then((function(e){}),(function(e){}))},onCopySuccess:function(){var e=this.$createElement;this.$notify({title:" 提示",type:"success",message:e("i",{style:"color: teal"},"已复制到剪贴板")})},onCopyError:function(){var e=this.$createElement;this.$notify({title:"提示",type:"error",message:e("i",{style:"color: teal"},"复制失败")})},imgIsChecked:function(e){return e?"img_checked":"img_not_checked"},handleCheckBoxChange:function(e,t){if(e)this.selectImages.push(t.ID);else{var a=this.selectImages.indexOf(t.ID);a>=0&&this.selectImages.splice(a,1)}},handleMultiCancel:function(){this.isMultiVisible=!1,this.selectImages=[];var e=this.data;e.map((function(e){return e.checked=!1,e})),this.data=e},handleMultiDelImages:function(){var e=this;0!==this.selectImages.length?this.$confirm("确定要删除吗?","删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then((function(){var t=e.selectImages.join(",");Object(n["b"])(t).then((function(t){e.$message.success(t.msg),e.fetchPageData()})).catch((function(){}))})).catch((function(){})):this.$message.error("请选择要删除的图片")}}},o=l,r=(a("1720"),a("2877")),c=Object(r["a"])(o,i,s,!1,null,"2dc8efb3",null);t["default"]=c.exports},baa5:function(e,t,a){var i=a("23e7"),s=a("e58c");i({target:"Array",proto:!0,forced:s!==[].lastIndexOf},{lastIndexOf:s})},d69a:function(e,t,a){},e58c:function(e,t,a){"use strict";var i=a("fc6a"),s=a("a691"),n=a("50c4"),l=a("a640"),o=a("ae40"),r=Math.min,c=[].lastIndexOf,p=!!c&&1/[1].lastIndexOf(1,-0)<0,u=l("lastIndexOf"),g=o("indexOf",{ACCESSORS:!0,1:0}),d=p||!u||!g;e.exports=d?function(e){if(p)return c.apply(this,arguments)||0;var t=i(this),a=n(t.length),l=a-1;for(arguments.length>1&&(l=r(l,s(arguments[1]))),l<0&&(l=a+l);l>=0;l--)if(l in t&&t[l]===e)return l||0;return-1}:c}}]);