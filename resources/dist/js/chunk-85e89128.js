(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-85e89128"],{"05ef":function(t,e,a){"use strict";a.d(e,"a",(function(){return r})),a.d(e,"c",(function(){return o})),a.d(e,"b",(function(){return l}));var n=a("5530"),i=a("22ce");function r(t){return Object(i["b"])({url:"/images",method:"get",params:t})}function o(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i["b"])(Object(n["a"])({url:"/images/attachment/upload",method:"post",data:t,headers:{token:localStorage.getItem("token"),"Content-Type":"multipart/form-data",Accept:"application/json"}},e))}function l(t){return Object(i["b"])({url:"/images?ids=".concat(t),method:"delete"})}},1421:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("d2-container",[a("template",{slot:"header"},[t._v("用户 / 页面")]),a("el-tabs",{attrs:{"tab-position":t.tabPosition,type:"border-card"},on:{"tab-click":t.handleTabClick}},[a("el-tab-pane",{attrs:{label:"独立页面"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-link"}),t._v(" 独立页面")]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.independentPageData}},[a("el-table-column",{attrs:{prop:"title",label:"页面名称",width:"150"}}),a("el-table-column",{attrs:{label:"页面地址",width:"450"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-link",{attrs:{target:"_blank",href:e.row.url,underline:!1}},[t._v(t._s(e.row.url))])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return t.handleManagePage(e.row.title)}}},[t._v("管理")])]}}])})],1)],1),a("el-tab-pane",{attrs:{label:"自定义页面"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"fa fa-link"}),t._v(" 自定义页面")]),a("div",{staticClass:"operation-box"},[a("el-form",{staticClass:"demo-form-inline",attrs:{slot:"header",inline:!0},slot:"header"},[a("el-form-item",[a("el-button",{attrs:{size:"small",type:"danger"},on:{click:t.handleMultiDelPages}},[a("i",{staticClass:"el-icon-delete"}),t._v(" 批量删除 ")])],1),a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleOpenAddDialog}},[a("i",{staticClass:"el-icon-plus"}),t._v(" 新增 ")])],1),a("el-form-item",[a("el-input",{attrs:{size:"small",placeholder:"请输入关键词"},model:{value:t.pagination.key,callback:function(e){t.$set(t.pagination,"key",e)},expression:"pagination.key"}})],1),a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.search}},[a("i",{staticClass:"el-icon-search"}),t._v(" 搜索")])],1),a("el-form-item",[a("el-button",{attrs:{size:"small"},on:{click:t.reset}},[a("i",{staticClass:"el-icon-refresh"}),t._v(" 重置")])],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.customPageData},on:{"selection-change":t.handleSelectChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{prop:"title",label:"页面名称",width:"150"}}),a("el-table-column",{attrs:{label:"页面地址",width:"450"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-link",{attrs:{target:"_blank",href:t.blogVars.ContextPath+"/custom/"+e.row.url,underline:!1}},[t._v(" "+t._s(t.blogVars.ContextPath+"/custom/"+e.row.url)+" ")])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return t.handleOpenEditDialog(e.row)}}},[t._v("编辑")]),t._v(" "),a("el-popconfirm",{attrs:{confirmButtonText:"确定",cancelButtonText:"取消",icon:"el-icon-info",iconColor:"red",title:"确定要删除吗？"},on:{onConfirm:function(a){return t.handleDelPage(e.row.ID)}}},[a("el-button",{attrs:{slot:"reference",size:"small",type:"text"},slot:"reference"},[t._v("删除")])],1)]}}])})],1),a("div",{staticClass:"page-box"},[a("el-pagination",{attrs:{background:"","page-sizes":[10,30,50],layout:"total, sizes, prev, pager, next, jumper","current-page":t.pagination.page,"page-size":t.pagination.size,"page-count":t.pagination.total_pages,total:t.pagination.total_num},on:{"size-change":t.handlePageSizeChange,"current-change":t.handleCurrentPageChange}})],1)],1)],1),a("el-dialog",{attrs:{title:"添加页面",visible:t.dialogOptions.addVisible,"with-header":!1,width:"60%"},on:{"update:visible":function(e){return t.$set(t.dialogOptions,"addVisible",e)}}},[a("el-form",{ref:"addForm",attrs:{model:t.addForm,rules:t.addFormRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"页面名称",prop:"title"}},[a("el-input",{staticStyle:{width:"50%"},attrs:{size:"small",type:"text",placeholder:"请输入页面名称"},model:{value:t.addForm.title,callback:function(e){t.$set(t.addForm,"title",e)},expression:"addForm.title"}})],1),a("el-form-item",{attrs:{label:"页面路径",prop:"url"}},[a("el-input",{staticStyle:{width:"50%"},attrs:{size:"small",type:"text",placeholder:"页面路径不要以 / 开头"},model:{value:t.addForm.url,callback:function(e){t.$set(t.addForm,"url",e)},expression:"addForm.url"}}),a("span",{staticClass:"form-tip"},[t._v(" "+t._s(t.blogVars.ContextPath+"/custom/"+t.addForm.url))])],1),a("el-form-item",{attrs:{label:"页面内容",prop:"html"}},[a("addEditor",{ref:"addEditor"})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",loading:t.dialogOptions.addBtnLoading},on:{click:t.handleAddPage}},[t._v("保存")]),a("el-button",{on:{click:function(e){t.dialogOptions.addVisible=!1}}},[t._v("取消")])],1)],1)],1),a("el-dialog",{attrs:{title:"修改页面",visible:t.dialogOptions.editVisible,"with-header":!1,width:"60%"},on:{"update:visible":function(e){return t.$set(t.dialogOptions,"editVisible",e)}}},[a("el-form",{ref:"editForm",attrs:{model:t.editForm,rules:t.editFormRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"页面名称",prop:"title"}},[a("el-input",{staticStyle:{width:"50%"},attrs:{size:"small",type:"text",placeholder:"请输入页面名称"},model:{value:t.editForm.title,callback:function(e){t.$set(t.editForm,"title",e)},expression:"editForm.title"}})],1),a("el-form-item",{attrs:{label:"页面路径",prop:"url"}},[a("el-input",{staticStyle:{width:"50%"},attrs:{size:"small",type:"text",placeholder:"页面路径不要以 / 开头"},model:{value:t.editForm.url,callback:function(e){t.$set(t.editForm,"url",e)},expression:"editForm.url"}}),a("span",{staticClass:"form-tip"},[t._v(" "+t._s(t.blogVars.ContextPath+"/custom/"+t.editForm.url))])],1),a("el-form-item",{attrs:{label:"页面内容",prop:"html"}},[a("editEditor",{ref:"editEditor",attrs:{content:t.editForm.html}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",loading:t.dialogOptions.editBtnLoading},on:{click:t.handleEditPage}},[t._v("保存")]),a("el-button",{on:{click:function(e){t.dialogOptions.editVisible=!1}}},[t._v("取消")])],1)],1)],1)],2)},i=[],r=(a("4160"),a("a15b"),a("ac1f"),a("5319"),a("159b"),a("5530")),o=(a("96cf"),a("1da1")),l=a("a2a9"),s=a("9b87"),c=a("9b3f"),d=a("22ce");function u(t){return Object(d["b"])({url:"/pages",method:"get",params:t})}function g(t){return Object(d["b"])({url:"/pages",method:"post",data:t})}function m(t){return Object(d["b"])({url:"/pages",method:"put",data:t})}function p(t){return Object(d["b"])({url:"/pages?ids=".concat(t),method:"delete"})}var h={name:"page",components:{addEditor:l["a"],editEditor:s["a"]},data:function(){return{tabPosition:"top",pagination:{page:1,size:10,key:"",total_num:0,total_pages:0},blogVars:{},selectList:[],independentPageData:[],customPageData:[],dialogOptions:{addVisible:!1,editVisible:!1,addBtnLoading:!1,editBtnLoading:!1},addForm:{title:"",url:"",html:"",md_html:""},editForm:{ID:null,title:"",url:"",html:"",md_html:""},addFormRules:{title:[{required:!0,trigger:"blur",message:"请输入页面名称"},{max:100,trigger:"blur",message:"页面名称不能超过 100 个字符"}],url:[{required:!0,trigger:"blur",message:"请输入页面路径"},{max:100,trigger:"blur",message:"页面路径不能超过 100 个字符"}],html:[{required:!0,pattern:/^(?!\n$)/,trigger:"blur",message:"请输入页面内容"},{max:1e5,trigger:"blur",message:"页面内容不能超过 100000 个字符"}],md_html:[{required:!0,trigger:"blur",message:"请输入 markdown 渲染的页面内容"},{max:1e6,trigger:"blur",message:"markdown 渲染的页面内容不能超过 100000 个字符"}]},editFormRules:{title:[{required:!0,trigger:"blur",message:"请输入页面名称"},{max:100,trigger:"blur",message:"页面名称不能超过 100 个字符"}],url:[{required:!0,trigger:"blur",message:"请输入页面路径"},{max:100,trigger:"blur",message:"页面路径不能超过 100 个字符"}],html:[{required:!0,pattern:/^(?!\n$)/,trigger:"blur",message:"请输入页面内容"},{max:1e5,trigger:"blur",message:"页面内容不能超过 100000 个字符"}],md_html:[{required:!0,trigger:"blur",message:"请输入 markdown 渲染的页面内容"},{max:1e6,trigger:"blur",message:"markdown 渲染的页面内容不能超过 100000 个字符"}]},loading:!1}},created:function(){this.initIndependentPageData()},methods:{resetForm:function(t){void 0!==this.$refs[t]&&this.$refs[t].resetFields()},clearValidate:function(t){void 0!==this.$refs[t]&&this.$refs[t].clearValidate()},fetchBlogVars:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["b"])().then((function(e){t.blogVars=e.data})).catch((function(){}));case 2:case"end":return e.stop()}}),e)})))()},fetchIndependentPageData:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.independentPageData=[{title:"日志页面",url:"".concat(t.blogVars.ContextPath,"/journals")},{title:"图库页面",url:"".concat(t.blogVars.ContextPath,"/galleries")}];case 1:case"end":return e.stop()}}),e)})))()},initIndependentPageData:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.fetchBlogVars();case 2:return e.next=4,t.fetchIndependentPageData();case 4:case"end":return e.stop()}}),e)})))()},fetchCustomPageData:function(){var t=this;this.loading=!0,setTimeout((function(e){u({page:t.pagination.page,size:t.pagination.size,key:t.pagination.key}).then((function(e){t.customPageData=e.data.data,t.pagination.total_num=e.data.total_num,t.pagination.total_pages=e.data.total_pages})).catch((function(t){})),t.loading=!1}),300)},handleTabClick:function(t){switch(t.label){case"独立页面":this.initIndependentPageData();break;case"自定义页面":this.fetchCustomPageData();break}},search:function(){this.pagination.page=1,this.fetchCustomPageData()},reset:function(){this.pagination.page=1,this.pagination.key="",this.fetchCustomPageData()},handleManagePage:function(t){"日志页面"===t?this.$router.replace("/page/journal"):"图库页面"===t&&this.$router.replace("/page/gallery")},handlePageSizeChange:function(t){this.pagination.size=t,this.fetchCustomPageData()},handleCurrentPageChange:function(t){this.pagination.page=t,this.fetchCustomPageData()},handleOpenAddDialog:function(){this.clearValidate("addForm"),this.dialogOptions.addVisible=!0},handleOpenEditDialog:function(t){this.editForm=Object(r["a"])({},t),this.dialogOptions.editVisible=!0},handleAddPage:function(){var t=this;this.dialogOptions.addBtnLoading=!0,setTimeout((function(e){t.addForm.html=t.$refs.addEditor.getContent(),t.addForm.md_html=t.$refs.addEditor.getHTML(),t.$refs.addForm.validate((function(e){e&&g(t.addForm).then((function(e){t.$message.success(e.msg),t.dialogOptions.addVisible=!1,t.resetForm("addForm"),t.fetchCustomPageData()})).catch((function(t){}))}),300),t.dialogOptions.addBtnLoading=!1}))},handleEditPage:function(){var t=this;this.dialogOptions.editBtnLoading=!0,setTimeout((function(e){t.editForm.html=t.$refs.editEditor.getContent(),t.editForm.md_html=t.$refs.editEditor.getHTML(),t.$refs.editForm.validate((function(e){e&&m(t.editForm).then((function(e){t.$message.success(e.msg),t.dialogOptions.editVisible=!1,t.fetchCustomPageData()})).catch((function(t){}))}),300),t.dialogOptions.editBtnLoading=!1}))},handleDelPage:function(t){var e=this,a=[t].join(",");p(a).then((function(t){e.$message.success(t.msg),e.fetchCustomPageData()})).catch((function(t){}))},handleSelectChange:function(t){var e=this;t.forEach((function(t){e.selectList.push(t.ID)}))},handleMultiDelPages:function(){var t=this;0!==this.selectList.length?this.$confirm("确定要删除吗?","删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then((function(e){var a=t.selectList.join(",");p(a).then((function(e){t.$message.success(e.msg),t.fetchCustomPageData()})).catch((function(t){}))})).catch((function(t){})):this.$message.error("请选择要删除的页面")}}},f=h,b=(a("250f"),a("2877")),v=Object(b["a"])(f,n,i,!1,null,"186db82e",null);e["default"]=v.exports},2139:function(t,e,a){},"250f":function(t,e,a){"use strict";var n=a("2139"),i=a.n(n);i.a},"60d3":function(t,e,a){"use strict";var n=a("c5e9"),i=a.n(n);i.a},a2a9:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"addEditor-box"},[a("div",{attrs:{id:"addEditor"}})])}],r=(a("ac1f"),a("5319"),a("b85c")),o=(a("96cf"),a("1da1")),l=a("ff41"),s=a.n(l),c=(a("b642"),a("9b3f")),d=a("05ef"),u={name:"addEditor",data:function(){return{contentEditor:null,headers:{},uploadUrl:null}},props:{content:{type:String,default:""}},mounted:function(){this.initEditor()},watch:{content:function(t){this.setContent(t)}},methods:{initEditor:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.contentEditor=new s.a("addEditor",{height:380,toolbarConfig:{pin:!0},cache:{enable:!1},hint:{emoji:{pray:"🙏",broken_heart:"💔",ok_hand:"👌",smile:"😄",laughing:"😆",smirk:"😏",heart_eyes:"😍",grin:"😁",stuck_out_tongue:"😛",expressionless:"😑",unamused:"😒",sob:"😭",joy:"😂",tired_face:"😫",blush:"😊",cry:"😢",fearful:"😨"}},counter:1e5,upload:{accept:".jpg,.png,.gif,.jpeg",max:2097152,filename:function(t){return t.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5.)]/g,"").replace(/[?\\/:|<>*[\]()$%{}@~]/g,"").replace("/\\s/g","")},handler:function(t){var e,a=new FormData,n=Object(r["a"])(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;a.append("file[]",i)}}catch(o){n.e(o)}finally{n.f()}Object(d["c"])(a).then((function(t){console.log(t)})).catch((function(){}))}},after:function(){t.setContent(t.content)}});case 1:case"end":return e.stop()}}),e)})))()},initHeaders:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.headers={token:localStorage.getItem("token"),"Content-Type":"multipart/form-data",Accept:"application/json"};case 1:case"end":return e.stop()}}),e)})))()},initUploadUrl:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["c"])("网站设置").then((function(e){var a=e.data.site_url;"/"===a.substr(-1)?t.uploadUrl=a+"images/attachment/upload":t.uploadUrl=a+"/images/attachment/upload"})).catch((function(){}));case 2:case"end":return e.stop()}}),e)})))()},getContent:function(){return this.contentEditor.getValue()},getHTML:function(){return this.contentEditor.getHTML()},setContent:function(t){this.contentEditor.setValue(t)}}},g=u,m=(a("60d3"),a("2877")),p=Object(m["a"])(g,n,i,!1,null,null,null);e["a"]=p.exports},c5e9:function(t,e,a){}}]);